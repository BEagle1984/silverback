<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.17.0 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Subscribing - Silverback - Page </title>
<meta name="description" content="Now all is left to do is write a subscriber method to process the produced messages.">


  <meta name="author" content="Sergio Aquilini">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Silverback">
<meta property="og:title" content="Subscribing">
<meta property="og:url" content="http://localhost:4000/silverback/docs/quickstart/subscribe">


  <meta property="og:description" content="Now all is left to do is write a subscriber method to process the produced messages.">







  <meta property="article:published_time" content="2020-12-13T12:38:35+01:00">






<link rel="canonical" href="http://localhost:4000/silverback/docs/quickstart/subscribe">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Sergio Aquilini",
      "url": "http://localhost:4000/silverback/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/silverback/feed.xml" type="application/atom+xml" rel="alternate" title="Silverback Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/silverback/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<link rel="apple-touch-icon" sizes="180x180" href="/silverback/assets/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/silverback/assets/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/silverback/assets/icons/favicon-16x16.png">
<link rel="manifest" href="/silverback/assets/icons/site.webmanifest">
<link rel="mask-icon" href="/silverback/assets/icons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/silverback/"><img src="/silverback/assets/images/logo.png" alt=""></a>
        
        
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/silverback/docs/introduction" >Documentation</a>
            </li><li class="masthead__menu-item">
              <a href="/silverback/docs/releases" >Releases</a>
            </li><li class="masthead__menu-item">
              <a href="/silverback/about" >About</a>
            </li><li class="masthead__menu-item">
              <a href="https://github.com/BEagle1984/silverback/" >GitHub</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          
          
          
          

          <a href="/silverback/docs/introduction" class="">Introduction</a>
        

        
      </li>
    
      <li>
        
          
          
          
          
          

          <a href="/silverback/docs/features" class="">Features</a>
        

        
      </li>
    
      <li>
        
          
          
          
          
          

          <a href="/silverback/docs/releases" class="">Releases</a>
        

        
      </li>
    
      <li>
        
          <span>Quickstart</span>
        

        
        <ul>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/quickstart" class="">Introduction and Glossary</a>
              

              
            </li>
          
            <li>
              
                <span>Using the Bus</span>
              

              
              <ul>
                
                  
                  

                  
                  

                  <li><a href="/silverback/docs/quickstart/bus" class="">Enabling the Bus</a></li>
                
                  
                  

                  
                  

                  <li><a href="/silverback/docs/quickstart/model" class="">Creating the Message model</a></li>
                
                  
                  

                  
                  

                  <li><a href="/silverback/docs/quickstart/publish" class="">Publishing</a></li>
                
                  
                  

                  
                  

                  <li><a href="/silverback/docs/quickstart/subscribe" class="active">Subscribing</a></li>
                
              </ul>
              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/quickstart/ddd" class="">DDD and Domain Events</a>
              

              
            </li>
          
            <li>
              
                <span>Integration using a Message Broker</span>
              

              
              <ul>
                
                  
                  

                  
                  

                  <li><a href="/silverback/docs/quickstart/message-broker" class="">Connecting a Message Broker</a></li>
                
                  
                  

                  
                  

                  <li><a href="/silverback/docs/quickstart/translating" class="">Translating Messages</a></li>
                
                  
                  

                  
                  

                  <li><a href="/silverback/docs/quickstart/headers" class="">Message Headers</a></li>
                
              </ul>
              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/quickstart/behaviors" class="">Behaviors</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/quickstart/testing" class="">Testing</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/quickstart/event-sourcing" class="">Event Sourcing</a>
              

              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span>Broker Configuration</span>
        

        
        <ul>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/configuration/endpoint" class="">Endpoint</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/configuration/outbound" class="">Outbound Connector</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/configuration/inbound" class="">Inbound Connector</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/configuration/mixed" class="">Mixed Configurations</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/configuration/external" class="">External Configuration</a>
              

              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span>Advanced</span>
        

        
        <ul>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/advanced/serialization" class="">Serialization</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/advanced/chunking" class="">Chunking</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/advanced/encryption" class="">Encryption</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/advanced/binary-files" class="">Binary Files</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/advanced/rx" class="">Observable Bus</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/advanced/broker" class="">Using IBroker</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/advanced/message-id" class="">Message Identifier</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/advanced/iinboundenvelope" class="">IInboundEnvelope</a>
              

              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span>Kafka Specific</span>
        

        
        <ul>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/kafka/message-key" class="">Message Key (partitioning)</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/kafka/multiple-consumer-groups" class="">Multiple Consumer Groups (in same process)</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/kafka/events" class="">Kafka Events</a>
              

              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span>RabbitMQ Specific</span>
        

        
        <ul>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/rabbit/routing-key" class="">Routing Key</a>
              

              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span>Extras</span>
        

        
        <ul>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/extra/dbcontext" class="">Sample DbContext (EF Core)</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/extras/background-services" class="">Distributed Background Services</a>
              

              
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span>Source Code</span>
        

        
        <ul>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/source/contributing" class="">Contributing</a>
              

              
            </li>
          
            <li>
              
                
                

                
                

                <a href="/silverback/docs/source/samples" class="">Samples</a>
              

              
            </li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Subscribing">
    <meta itemprop="description" content="Now all is left to do is write a subscriber method to process the produced messages.">
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Subscribing
</h1>
          
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title">In this page:</h4></header>
              <ul class="toc__menu">
  <li><a href="#type-based-subscription">Type based subscription</a>
    <ul>
      <li><a href="#registering-types-not-implementing-isubscriber">Registering types not implementing ISubscriber</a></li>
      <li><a href="#explicit-method-subscription">Explicit method subscription</a></li>
    </ul>
  </li>
  <li><a href="#delegate-based-subscription">Delegate based subscription</a></li>
  <li><a href="#supported-methods-and-parameters">Supported methods and parameters</a></li>
  <li><a href="#return-values">Return values</a></li>
  <li><a href="#return-new-messages-republishing">Return new messages (republishing)</a>
    <ul>
      <li><a href="#using-assembly-scanning">Using assembly scanning</a></li>
    </ul>
  </li>
  <li><a href="#bootstrapping">Bootstrapping</a></li>
</ul>
            </nav>
          </aside>
        
        <p>Now all is left to do is write a subscriber method to process the produced messages.</p>

<h2 id="type-based-subscription">Type based subscription</h2>

<p>The default and usually preferred way to subscribe is by implementing the marker interface <code class="highlighter-rouge">ISubscriber</code>.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Silverback.Messaging.Subscribers</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">SubscribingService</span> <span class="p">:</span> <span class="n">ISubscriber</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">OnMessageReceived</span><span class="p">(</span><span class="n">SampleMessage</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...your message handling loging...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<figure class="csharp">
<figcaption>Startup.cs</figcaption>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Startup</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">services</span>
            <span class="p">.</span><span class="nf">AddSilverback</span><span class="p">()</span>
            <span class="p">.</span><span class="n">AddScopedSubscriber</span><span class="p">&lt;</span><span class="n">SubscribingService</span><span class="p">&gt;();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

</figure>

<p>All subscribers must be registered with the service provider as shown in the second code snippet above and all public methods are automatically subscribed by default (see  the <a href="#explicit-method-subscription">explicit method subscription</a> chapter, if more control over is desired).</p>

<p class="notice--note">All <code class="highlighter-rouge">Add*Subscriber</code> methods are available also as extensions to the <code class="highlighter-rouge">IServiceCollection</code> and it isn’t therefore mandatory to call them immediately after <code class="highlighter-rouge">AddSilverback</code>.</p>

<h3 id="registering-types-not-implementing-isubscriber">Registering types not implementing ISubscriber</h3>

<p>If you don’t want to implement <code class="highlighter-rouge">ISubscriber</code> you can register other types (directly or using a base classe or interface).</p>

<figure class="csharp">
<figcaption>Startup.cs</figcaption>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Startup</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">services</span>
            <span class="p">.</span><span class="nf">AddSilverback</span><span class="p">()</span>
            <span class="p">.</span><span class="n">AddScopedSubscriber</span><span class="p">&lt;</span><span class="n">SubscribingService</span><span class="p">&gt;();</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">BusConfigurator</span> <span class="n">busConfigurator</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">busConfigurator</span>
            <span class="p">.</span><span class="n">Subscribe</span><span class="p">&lt;</span><span class="n">SubscribingService</span><span class="p">&gt;();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

</figure>
<p>…or…</p>
<figure class="csharp">
<figcaption>Startup.cs</figcaption>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Startup</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">services</span>
            <span class="p">.</span><span class="nf">AddSilverback</span><span class="p">()</span>
            <span class="p">.</span><span class="n">AddScopedSubscriber</span><span class="p">&lt;</span><span class="n">ICustomSubscriber</span><span class="p">,</span> <span class="n">SubscribingService1</span><span class="p">&gt;()</span>
            <span class="p">.</span><span class="n">AddScopedSubscriber</span><span class="p">&lt;</span><span class="n">ICustomSubscriber</span><span class="p">,</span> <span class="n">SubscribingService2</span><span class="p">&gt;()</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">BusConfigurator</span> <span class="n">busConfigurator</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">busConfigurator</span><span class="p">.</span><span class="n">Subscribe</span><span class="p">&lt;</span><span class="n">ICustomSubscriber</span><span class="p">&gt;();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

</figure>

<p class="notice--note">This could be useful to avoid a reference to Silverback in lower layers.</p>

<h3 id="explicit-method-subscription">Explicit method subscription</h3>

<p>You can explicitely subscribe a method using the <code class="highlighter-rouge">SubscribeAttribute</code> (this allows you to subscribe non-public methods as well).</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Silverback.Messaging.Subscribers</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">SubscribingService</span> <span class="p">:</span> <span class="n">ISubscriber</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">Subscribe</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">OnMessageReceived</span><span class="p">(</span><span class="n">SampleMessage</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...your message handling loging...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">SubscribeAttribute</code> exposes three extra properties, that can be used to enable parallelism:</p>
<ul>
  <li><code class="highlighter-rouge">Exclusive</code>: A boolean value indicating whether the method can be executed concurrently to other methods handling the <strong>same message</strong>. The default value is <code class="highlighter-rouge">true</code> (the method will be executed sequentially to other subscribers).</li>
  <li><code class="highlighter-rouge">Parallel</code>: A boolean value indicating whether the method can be executed concurrently when multiple messages are fired at the same time (e.g. in a batch). The default value is <code class="highlighter-rouge">false</code> (the messages are processed sequentially).</li>
  <li><code class="highlighter-rouge">MaxDegreeOfParallelism</code>: Limit the number of messages that are processed concurrently. Used only together with <code class="highlighter-rouge">Parallel = true</code> and mostly useful when performing CPU-bound work (as opposed to non-blocking I/O). The default value is <code class="highlighter-rouge">Int32.Max</code> and means that there is no limit to the degree of parallelism.</li>
</ul>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">SubscribingService</span> <span class="p">:</span> <span class="n">ISubscriber</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">Parallel</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">MaxDegreeOfParallelism</span> <span class="p">=</span> <span class="m">10</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">OnMessageReceived</span><span class="p">(</span><span class="n">SampleMessage</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...your message handling loging...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>It is also possible to completely disable the automatic subscription of the public methods.</p>

<figure class="csharp">
<figcaption>Startup.cs</figcaption>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Startup</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">BusConfigurator</span> <span class="n">busConfigurator</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">busConfigurator</span><span class="p">.</span><span class="n">Subscribe</span><span class="p">&lt;</span><span class="n">ISubscriber</span><span class="p">&gt;(</span>
            <span class="n">autoSubscribeAllPublicMethods</span><span class="p">:</span> <span class="k">false</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

</figure>

<h2 id="delegate-based-subscription">Delegate based subscription</h2>

<p>It is also possible to subscribe an inline lambda or integrate an existing method without having to modify the codebase to add the <code class="highlighter-rouge">SubscribeAttribute</code>.</p>

<figure class="csharp">
<figcaption>Startup.cs</figcaption>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Startup</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">BusConfigurator</span> <span class="n">busConfigurator</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">busConfigurator</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span>
            <span class="p">(</span><span class="n">IReadOnlyCollection</span><span class="p">&lt;</span><span class="n">IMessage</span><span class="p">&gt;</span> <span class="n">message</span><span class="p">)</span> <span class="p">=&gt;</span>
                <span class="nf">HandleMessage</span><span class="p">(</span><span class="n">message</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

</figure>

<p>Multiple overloads of the <code class="highlighter-rouge">Subscribe</code> method exist and you can optionally provide a <code class="highlighter-rouge">SubscriptionOptions</code> instance to enable parallelism (analog to the properties set to the <code class="highlighter-rouge">SubscribeAttribute</code>).</p>

<figure class="csharp">
<figcaption>Startup.cs</figcaption>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Startup</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">BusConfigurator</span> <span class="n">busConfigurator</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">busConfigurator</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span>
            <span class="p">(</span><span class="n">MyMessage</span> <span class="n">message</span><span class="p">,</span> <span class="n">MyService</span> <span class="n">service</span><span class="p">)</span> <span class="p">=&gt;</span>
                <span class="n">service</span><span class="p">.</span><span class="nf">HandleMessage</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
            <span class="k">new</span> <span class="n">SubscriptionOptions</span> 
            <span class="p">{</span> 
                <span class="n">Parallel</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> 
                <span class="n">Exclusive</span> <span class="p">=</span> <span class="k">false</span> 
            <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

</figure>

<h2 id="supported-methods-and-parameters">Supported methods and parameters</h2>

<p>The subscribed method can either be synchronous or asynchronous, but the asynchronous approach should be preferred if aiming at taking advantage of non-blocking I/O.</p>

<p>The first parameter must be the message or the collection of messages.
The following collection are supported:</p>
<ul>
  <li><code class="highlighter-rouge">IEnumerable&lt;TMessage&gt;</code> or <code class="highlighter-rouge">IReadOnlyCollection&lt;TMessage&gt;</code>: To be able to handle a batch of messages at once. It will receive also the single messages (in a collection with a single item). (Silverback will in any case always forward a materialized <code class="highlighter-rouge">IList</code> of messages, but explicitly declaring the paramter as <code class="highlighter-rouge">IReadOnlyCollection&lt;T&gt;</code> avoids any false positive <em>“possible multiple enumeration of IEnumerable”</em> issue that may be detected by a static code analysis tool.)</li>
  <li><code class="highlighter-rouge">Observable&lt;TMessage&gt;</code>: <code class="highlighter-rouge">Silverback.Core.Rx</code> allows you to handle your messages in a reactive programming fashion.</li>
</ul>

<p>Using a collection as parameter allows you to handle a batch of messages at once, allowing more control. The methods with a collection as parameter will still be called for single messages and methods with a single message as input parameter will be called for each message in a batch (in parallel, if allowed by the specified configuration).</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Silverback.Messaging.Subscribers</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">SubscribingService</span> <span class="p">:</span> <span class="n">ISubscriber</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">Parallel</span><span class="p">=</span><span class="k">true</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">OnMessageReceived</span><span class="p">(</span><span class="n">Observable</span><span class="p">&lt;</span><span class="n">SampleMessage</span><span class="p">&gt;</span> <span class="n">stream</span><span class="p">)</span> <span class="p">=&gt;</span>
        <span class="n">stream</span><span class="p">...</span><span class="nf">Subscribe</span><span class="p">(...);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The method can have other parameters that will be resolved using the service provider. Very useful also to integrate existing code.</p>

<figure class="csharp">
<figcaption>Startup.cs</figcaption>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Startup</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">BusConfigurator</span> <span class="n">busConfigurator</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">busConfigurator</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span>
            <span class="p">(</span><span class="n">BasketCheckoutMessage</span> <span class="n">message</span><span class="p">,</span> <span class="n">CheckoutService</span> <span class="n">service</span><span class="p">)</span> <span class="p">=&gt;</span> 
                <span class="n">service</span><span class="p">.</span><span class="nf">Handle</span><span class="p">(</span><span class="n">message</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

</figure>

<h2 id="return-values">Return values</h2>

<p>A subscriber can also have a return value that can be collected by the publisher.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Silverback.Messaging.Subscribers</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">SubscribingService</span> <span class="p">:</span> <span class="n">ISubscriber</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">SampleResult</span><span class="p">&gt;</span> <span class="nf">OnMessageReceived</span><span class="p">(</span><span class="n">SampleMessage</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nf">SampleResult</span><span class="p">(...);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="return-new-messages-republishing">Return new messages (republishing)</h2>

<p>A subscribed method can also optionally return a message or a collection of messages (either <code class="highlighter-rouge">IEnumerable&lt;TMessage&gt;</code>, <code class="highlighter-rouge">IReadOnlyCollection&lt;TMessage&gt;</code> or <code class="highlighter-rouge">Observable&lt;TMessage&gt;</code>, if using <code class="highlighter-rouge">Silverback.Core.Rx</code>) that will be automatically republished to the internal bus.</p>

<p>Silverback recognizes per default only the messages implementing <code class="highlighter-rouge">IMessage</code> but you can register your own types.</p>

<figure class="csharp">
<figcaption>Startup.cs</figcaption>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Startup</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">BusConfigurator</span> <span class="n">busConfigurator</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">busConfigurator</span>
            <span class="p">.</span><span class="n">HandleMessagesOfType</span><span class="p">&lt;</span><span class="n">MyCustomType</span><span class="p">&gt;();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

</figure>

<h3 id="using-assembly-scanning">Using assembly scanning</h3>

<p>You may use a Dependency Injection framework such as <a href="https://autofac.org/">Autofac</a> providing assembly scanning.</p>

<p>You can of course use such framework to register the subscribers, the only thing to keep in mind is that they need to be registered both as the marker interface (<code class="highlighter-rouge">ISubscriber</code>, unless configured otherwise) and as the type itself.</p>

<p>Example using Autofac:</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">SubscribersModule</span> <span class="p">:</span> <span class="n">Module</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Load</span><span class="p">(</span><span class="n">ContainerBuilder</span> <span class="n">builder</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">builder</span><span class="p">.</span><span class="nf">RegisterAssemblyTypes</span><span class="p">(</span><span class="n">Assembly</span><span class="p">.</span><span class="nf">GetExecutingAssembly</span><span class="p">())</span>
            <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">t</span> <span class="p">=&gt;</span> <span class="n">t</span><span class="p">.</span><span class="n">IsAssignableTo</span><span class="p">&lt;</span><span class="n">ISubscriber</span><span class="p">&gt;())</span>
            <span class="p">.</span><span class="nf">AsImplementedInterfaces</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">AsSelf</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">InstancePerLifetimeScope</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="bootstrapping">Bootstrapping</h2>

<p>The very first publish will take a bit longer and use more resources, since all subscribers have to be resolved (instantiated) once, in order for Silverback to scan the subscriber methods and figure out which message type is handled.</p>

<p>This operation can be performed at startup, preloading the necessary information.</p>

<p>It will of course still cause all subscribers to be instantiated, but it’s done in a more predictable and controlled way, without affecting the application performance later on (e.g. when handling the first HTTP request).</p>

<figure class="csharp">
<figcaption>Startup.cs</figcaption>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Startup</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">BusConfigurator</span> <span class="n">busConfigurator</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">busConfigurator</span><span class="p">.</span><span class="nf">ScanSubscribers</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

</figure>

        
      </section>

      

      

      
  <nav class="pagination">
    
      <a href="/silverback/docs/quickstart/publish" class="pagination--pager" title="Publishing
">Previous</a>
    
    
      <a href="/silverback/docs/quickstart/ddd" class="pagination--pager" title="DDD and Domain Events
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
        

        
        
            
            <li><a href="https://github.com/BEagle1984" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
            
        
            
            <li><a href="mailto:silverback-project@outlook.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope" aria-hidden="true"></i> Email</a></li>
            
        
        
    </ul>
</div>
  
<div class="page__footer-copyright">&copy; 2020 Sergio Aquilini. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; based on <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    
  <script src="/silverback/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/silverback/assets/js/lunr/lunr.min.js"></script>
<script src="/silverback/assets/js/lunr/lunr-store.js"></script>
<script src="/silverback/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
