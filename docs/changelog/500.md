---
uid: releases-500
---

# Release Notes v5.x.x

## [5.0.0-beta.1](https://github.com/BEagle1984/silverback/releases/tag/v5.0.0-beta.1)

Silverback 5.0.0 is the most significant update in the library’s history, built on years of user feedback and real-world experience. This release is more than just an upgrade—it’s a **complete refactoring** that enhances flexibility, performance, and maintainability while laying a strong foundation for future innovations.

### What's New

* Clean up code and increase tests coverage
* Reduce allocations and improve performance in many places
* Add `CancellationToken` support to the mediator <xref:mediator>
* Improve builders for error policies
* Support subscribers returning `ValueTask`
* Support exponential delay in `RetryErrorPolicy`
* Add new `AddHeader`, `WithMessageId` and `WithKafkaKey` overloads in <xref:ProducerEndpointConfigurationBuilder> for easier and more readable configuration
* Introduce typed endpoints registration using `Consume<TMessage>` and `Produce<TMessage>` methods (replacing `AddInbound` and `AddOutbound`), making the nested configuration more readable and type-safe. (see <xref:produce-configuration> and <xref:consume-configuration>)
* Automatically set the typed deserializer according to the message type when using `Consume<TMessage>` to configure the endpoint (see <xref:consume-deserializing>)
* Automatically set the typed <xref:Silverback.Messaging.BinaryMessages.BinaryMessageDeserializer`1> according to the message type when using `Consume<TMessage>` to configure the endpoint (see <xref:consume-binary>)
* Add full fluent API for Kafka and MQTT configuration (see <xref:produce-configuration> and <xref:consume-configuration>)
* Rewrite storage implementation from scratch and introduce new [Silverback.Storage.PostgreSql](https://www.nuget.org/packages/Silverback.Storage.PostgreSql/), [Silverback.Storage.Sqlite](https://www.nuget.org/packages/Silverback.Storage.Sqlite/), [Silverback.Storage.EntityFramework](https://www.nuget.org/packages/Silverback.Storage.EntityFramework/) and [Silverback.Storage.Memory](https://www.nuget.org/packages/Silverback.Storage.Memory/) packages, see <xref:storage>
* Refactor transactional outbox adding support for transaction enlistment (even if not using Entity Framework) and improving performance (see <xref:produce-outbox>)
* Improved outbox worker reliability
* Add message filtering in producer configuration (see <xref:produce-routing>)
* Improve and simplify tombstone handling (see <xref:produce-tombstone> and <xref:consume-tombstone>)
* Add `IInboundEnvelope` extensions to get broker specific metadata such as `GetKafkaOffset()`, `GetKafkaTimestamp()`, `GetMqttResponseTopic()` and `GetMqttCorrelationData()`
* Add `IOutboundEnvelope` extensions to set broker specific metadata such as `SetKafkaKey()`, `SetMqttResponseTopic()` and `SetMqttCorrelationData()`
* Add `WrapAndProduce` and `WrapAndProduceAsync` methods to <xref:IPublisher> to allow envelope enrichment (setting headers, kafka key, etc.) and dynamic routing (see <xref:produce-wrap>)
* Add `WrapAndProduceBatch` and `WrapAndProduceBatchAsync` methods to <xref:IPublisher> (see <xref:produce-wrap>) with the same capabilities of `WrapAndProduce` and `WrapAndProduceAsync`, supporting streaming, mapping and efficient batching with Kafka (see <xref:produce-wrap>)
* Refactor and improve <xref:Silverback.Domain.EntityFrameworkDomainEventsPublisher`1>
* Improved `ITestingHelper` to allow waiting for specific topics to be consumed (see <xref:testing>)
* Add <xref:Silverback.Messaging.Messages.InboundEnvelopeBuilder`1> and <xref:Silverback.Messaging.Messages.OutboundEnvelopeBuilder`1> to testing packages to help creating test envelopes (see <xref:testing>)
* Support Kafka cooperative sticky partition assignment strategy
* Implement transactional client-side offset storage (see <xref:consume-kafka-offset>)
* Support Kafka transactions (see <xref:produce-kafka-transaction>)
* Add support for Confluent schema registry (Avro, Json and Protobuf), including mock for in-memory testing
* Add `IgnoreNoMatchingSubscribersError` setting to MQTT producer endpoints, to prevent throwing when no subscriber is consuming the produced message
* Basic support for MQTT 5 request-response
* Upgrade to [Confluent.Kafka 2.8.0](https://github.com/confluentinc/confluent-kafka-dotnet/releases/tag/v2.2.0)
* Upgrade to [MQTTnet 5.0.1.1416](https://github.com/chkr1011/MQTTnet/releases/tag/v5.0.1.1416)

### Breaking Changes

* Increase default [KafkaConsumerEndpoint.MaxDegreeOfParallelism](xref:Silverback.Messaging.KafkaConsumerEndpoint#Silverback_Messaging_KafkaConsumerEndpoint_MaxDegreeOfParallelism) to 100
* Increase default `KafkaConsumer` backpressure limit to 50
* `JsonSerializer` typename handling `None` by default (security)
* Changed some details in <xref:Silverback.Messaging.Broker.IBroker>/<xref:Silverback.Messaging.Broker.IConsumer> and their implementations
* Reorganized the configuration namespaces, some extension methods might have been moved to a different namespace, thus requiring a different `using`.
* Refactored the endpoint models
    * Changed the endpoint models to [records](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/record) with init-only properties
    * Removed constructors with parameters
    * Refactored, redesigned and deprecated some properties
    * Building the endpoints directly is still supported but the strongly recommended preferred way is to use the builders, therefore from now on the documentation will only show that approach
    * TO-DO: Endpoint to Configuration and related renames (builders, etc.)
* Removed the `IOutboundRouter` interface and all `AddOutbound` overloads accepting a custom `IOutboundRouter`
* Removed all builders interfaces and exposed the actual classes directly (e.g. `ISilverbackBuilder` to `SilverbackBuilder`)
* Replaced `Endpoint`, `ProducerEndpoint` and `ConsumerEndpoint` with <xref:EndpointConfiguration>, <xref:ProducerConfiguration>, <xref:ConsumerConfiguration>
* Removed `IEndpoint`, `ProducerEndpoint` and `IConsumerEndpoint` interfaces
* `SubscriptionOptions` to `TypeSubscriptionOption` / `DelegateSubscriptionOptions`
* TO-BE-COMPARED / TO-BE-REVIEWED
    * IMessageSerializer
    * IKafkaProducerEndpointNameResolver
    * ConsumerBuilder / ProducerBuilder
    * UseEndpointNameResolver to UseEndpointResolver (and interface name)
    * ProduceTo with delegates only receive message instead of envelope (same for resolver)
    * Endpoint builders functions now work with `TMessage` instead of `Envelope<TMessage>` (e.g. `ProducerTo`)
    * AddOutboundEndpointsCheck renamed to AddProducersCheck
    * IOutboundQueueHealthCheckService to IOutboxHealthCheckService
    * Configuration namespace changed from Messaging.Configuration to Configuration for some types (ISilverbackConfigurator)
    * EndpointsConfiguration redesigned completely
        * Endpoints configuration moved completely under `Messaging.Configuration` namespace
    * KafkaEndpoint.Configure -> KafkaConfiguration.ConfigureClient
    * Broker -> BrokerBase
    * AddConsumer -> AddConsumerAsync / GetProducer -> GetProducerAsync
    * BinaryFileMessage and serializers renamed to BinaryFile + ConsumeBinaryFiles -> ConsumeBinaryMessages
    * DistributedBackgroundService / RecurringDBS
    * IOutboxReader / IOutboxWriter namespace + move to storage
    * Publisher and behaviors to `ValueTask`
    * `Helper.GetProducer` and other differences
    * `Add*BrokerCallbackHandler` to `Add*BrokerClientCallback` (`IBrokerCallback` to `IBrokerClientCallback`)
    * `IEndpointsConfiguredCallback` to `IBrokerClientsConfiguredCallback`
    * Removed `EndpointBuilder.WithName()` -> replaced by name parameter
    * Renamed Inbound namespace to Consuming and Outbound to Producing
    * Split IMessageSerializer / IMessageDeserializer and rename UseFixedType to UseModel
    * Removed Ping health check
    * Kafka key not set to random Guid anymore (will be null if not explicitly set)
    * Merged MessageId and KafkaKey headers -> MessageId will not be initialized with random Guid anymore
    * Deprecated the ProduceAsync with callback (it didn't make sense)
    * Deprecated NullMessageHandlingStrategy (now tombstones can always be consumed both as `null` or as `Tombstone`)
    * Moved `PublishToInternalBus` 
    * WithKafkaKey -> SetKafkaKey
    * IBehavior will be invoked for produced messages only with EnableSubscribing (see also SortIndex)
* `BatchSettings`, `ChunkSettings`, `SequenceSettings`, ` EncryptionSettings`, etc. renamed to `BatchConfiguration`, `ChunkConfiguration`, `SequenceConfiguration`, ` EncryptionConfiguration`, etc.
* Deprecated EF package
* Changed integration of domain entities / domain events with DbContext
* Deprecated ExactlyOnceStrategy -> replaced with ???client-side-offset-storage???
* Slight changes to policy builder (e.g. removed some overloads of PolicyBuilder.Retry/ThenRetru)
* Some changes to the `AddDelegateSubscriber` methods
* IBroker/IBrokerCollection -> IProducerFactory / IConsumerCollection
* Additional changes to configuration
* Removed `AddConsumer`/`AddProducer` from `IBroker`/`IBrokerCollection`
* e.g. `KafkaBroker.GetProducer` -> `IProducerFactory.GetProducer(endpointName)`/`IProducerFactory.GetProducer<TProducer>(endpointName)`/`IProducerFactory.GetProducer(configuration)`/...
* Changes to Kafka callbacks (stats etc.) -> replaced producer/consumer
* PartitionOffsetsProvider returns `ValueTask`
* Many interfaces changed to return a `ValueTask` instead of `Task`:
    * `IPublisher` async methods
    * `IBehavior`, `IProducerBehavior`, `IConsumerBehavior`
* `IEventPublisher`, `ICommandPublisher` and `IQueryPublisher` replaced by extension methods on the <xref:IPublisher>
    * Removed the `UseModel` method

### Deprecation Notice

The support for RabbitMQ has been deprecated? (...in case explain motivation etc....)
