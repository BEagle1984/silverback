<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Binary Files | Silverback </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Binary Files | Silverback ">
    <meta name="generator" content="docfx 2.56.5.0">
    
  
    <link rel="apple-touch-icon" sizes="180x180" href="../../images/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../images/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../images/icons/favicon-16x16.png">
    <link rel="manifest" href="../../images/icons/site.webmanifest">
    <link rel="mask-icon" href="../../images/icons/safari-pinned-tab.svg" color="#5bbad5">
  
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
    <script src="https://kit.fontawesome.com/e3306be642.js" crossorigin="anonymous"></script>
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../images/logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="binary-files">
<h1 id="binary-files">Binary Files</h1>

<p>Serializing a binary file (a byte array) using the regular <a class="xref" href="../../api/Silverback.Messaging.Serialization.JsonMessageSerializer.html">JsonMessageSerializer</a> would mean to encode it in base64 and convert it to a UTF-8 encoded byte array. Beside not being very elegant this approach may cause you some trouble when integrating with other systems expecting the raw file content. This procedure would also result in the transferred byte array to be approximately a 30% bigger than the file itself.</p>
<p>In this page it's shown how to use an <a class="xref" href="../../api/Silverback.Messaging.Messages.IBinaryFileMessage.html">IBinaryFileMessage</a> to more efficiently transfer binary files.</p>
<h2 id="producing-using-ibinaryfilemessage">Producing using IBinaryFileMessage</h2>
<p>The <a class="xref" href="../../api/Silverback.Messaging.Messages.IBinaryFileMessage.html">IBinaryFileMessage</a> interface is meant to transfer files over the message broker and is natively supported by Silverback. This means that the raw file content will be transferred in its original form.</p>
<p>For convenience the <code>BinaryFileMessage</code> class already implements the <a class="xref" href="../../api/Silverback.Messaging.Messages.IBinaryFileMessage.html">IBinaryFileMessage</a> interface. This class exposes a <code>ContentType</code> property as well, resulting in the <code>content-type</code> <a class="xref" href="../quickstart/message-broker/headers.html">header</a> to be produced.</p>
<pre><code class="lang-csharp">public class FileTransferService
{
    private readonly IPublisher _publisher;

    public FileTransferService(IPublisher publisher)
    {
        _publisher = publisher;
    }

    public async Task TransferFile(byte[] content, string contentType)
    {
        await _publihser.PublishAsync(
            new BinaryFileMessage(content, contentType));
    }
}
</code></pre>
<p>Otherwise you can implement the interface yourself or extend the <code>BinaryFileMessage</code> (e.g. to add some additional headers, as explained in the <a class="xref" href="../quickstart/message-broker/headers.html">Message Headers</a> section of the quickstart).</p>
<pre><code class="lang-csharp">public class MyBinaryFileMessage : BinaryFileMessage
{
    [Header(&quot;x-user-id&quot;)]
    public Guid UserId { get; set; }
}
</code></pre>
<h2 id="consuming-an-ibinaryfilemessage">Consuming an IBinaryFileMessage</h2>
<p>You don't need to do anything special to consume a binary file, if all necessary headers are in place (ensured by Silverback, if it was used to produce the message). The message will be wrapped again in a <code>BinaryFileMessage</code> that can be subscribed like any other message.</p>
<pre><code class="lang-csharp">public class FileConsumerService
{
    public async Task OnFileReceived(IBinaryFileMessage message)
    {
        // ...your file handling logic...
    }
}
</code></pre>
<p>If the message wasn't produced by Silverback chances are that the message type header is not there. In that case you need to explicitly configure the <a class="xref" href="../../api/Silverback.Messaging.BinaryFiles.BinaryFileMessageSerializer.html">BinaryFileMessageSerializer</a> in the inbound endpoint.</p>
<pre><code class="lang-csharp">public class MyEndpointsConfigurator : IEndpointsConfigurator
{
    public void Configure(IEndpointsConfigurationBuilder builder)
    {
        builder.AddInbound(
            new KafkaConsumerEndpoint(&quot;basket-events&quot;)
            {
                Serializer = BinaryFileMessageSerializer.Default
            });
    }
}
</code></pre>
<p>If you need to read additional headers you can either subscribe to an <code>IInboundEnvelope&lt;BinaryFileMessage&gt;</code> or extend the <code>BinaryFileMessage</code> (or implement the <a class="xref" href="../../api/Silverback.Messaging.Messages.IBinaryFileMessage.html">IBinaryFileMessage</a> interface from scratch). In this case you need to adapt the serializer configuration as well.</p>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_custommodel" role="tab" aria-controls="tabpanel_CeZOj-G++Q_custommodel" data-tab="custommodel" tabindex="0" aria-selected="true">Message Model</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_custommodel-configurator" role="tab" aria-controls="tabpanel_CeZOj-G++Q_custommodel-configurator" data-tab="custommodel-configurator" tabindex="-1">EndpointsConfigurator</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q_custommodel" role="tabpanel" data-tab="custommodel">

<pre><code class="lang-csharp">public class MyBinaryFileMessage : BinaryFileMessage
{
    [Header(&quot;x-user-id&quot;)]
    public Guid UserId { get; set; }
}
</code></pre>
</section>
<section id="tabpanel_CeZOj-G++Q_custommodel-configurator" role="tabpanel" data-tab="custommodel-configurator" aria-hidden="true" hidden="hidden">

<pre><code class="lang-csharp">public class MyEndpointsConfigurator : IEndpointsConfigurator
{
    public void Configure(IEndpointsConfigurationBuilder builder)
    {
        builder.AddInbound(
            new KafkaConsumerEndpoint(&quot;basket-events&quot;)
            {
                Serializer = new BinaryFileMessageSerializer&lt;MyBinaryFileMessage&gt;()
            });
    }
}
</code></pre>
</section>
</div>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/beagle1984/silverback/blob/master/docs/concepts/advanced/binary-files.md/#L1" class="contribution-link">Improve this doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="footer">
          <div class="container contacts">
            <a href="https://github.com/BEagle1984" rel="nofollow noopener noreferrer"><i class='fab fa-github'></i> GitHub</a>
            <a href="mailto:silverback-project@outlook.com" rel="nofollow noopener noreferrer"><i class='fas fa-envelope'></i> E-Mail</a>
          </div>
          <div class="container">
            <span class="pull-right">
              <a href="#top">&uarr; Back to top</a>
            </span>
            © 2020 Sergio Aquilini
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
