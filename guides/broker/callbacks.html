<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Broker Callbacks | Silverback </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Broker Callbacks | Silverback ">
    <meta name="generator" content="docfx ">
  

    <link rel="apple-touch-icon" sizes="180x180" href="../../images/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../images/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../images/icons/favicon-16x16.png">
    <link rel="manifest" href="../../images/icons/site.webmanifest">
    <link rel="mask-icon" href="../../images/icons/safari-pinned-tab.svg" color="#5bbad5">

    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
  
  <meta property="docfx:rel" content="../../">
  
    <script src="https://kit.fontawesome.com/e3306be642.js" crossorigin="anonymous"></script>
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../images/logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="broker-callbacks">
<h1 id="broker-callbacks">Broker Callbacks</h1>

<p>Broker callbacks allow you to handle specific events during the lifecycle of a message broker client. These callbacks help you react to various broker-related events.</p>
<h2 id="registering-a-callback-handler">Registering a Callback Handler</h2>
<p>To use a callback, implement the corresponding interface and register the handler using one of the following methods:</p>
<ul>
<li><code>AddSingletonBrokerCallbacksHandler&lt;THandler&gt;()</code></li>
<li><code>AddScopedBrokerCallbacksHandler&lt;THandler&gt;()</code></li>
<li><code>AddTransientBrokerCallbacksHandler&lt;THandler&gt;()</code></li>
</ul>
<h2 id="generic-callback">Generic Callback</h2>
<p>The following callback applies to all broker implementations:</p>
<ul>
<li><a class="xref" href="../../api/Silverback.Messaging.Broker.Callbacks.IBrokerClientsConfiguredCallback.html">IBrokerClientsConfiguredCallback</a><br>
Invoked immediately after the broker clients have been initialized based on the specified client and endpoint configuration.</li>
</ul>
<h3 id="example-registering-a-ibrokerclientsconfiguredcallback">Example: Registering a IBrokerClientsConfiguredCallback</h3>
<pre><code class="lang-csharp">.AddSilverback()
.WithConnectionToMessageBroker(options =&gt; options.AddKafka())
.AddKafkaClients(clients =&gt; clients
    .WithBootstrapServers(...)
    .AddProducer(...)
    .AddConsumer(...))
.AddSingletonBrokerCallbacksHandler&lt;MyCallbackHandler&gt;();
</code></pre>
<pre><code class="lang-csharp">public class MyCallbackHandler : IBrokerClientsConfiguredCallback
{
    public async Task OnBrokerClientsConfiguredAsync()
    {
        // Perform required initialization logic
    } 
}
</code></pre>
<h2 id="kafka-specific-callbacks">Kafka-Specific Callbacks</h2>
<p><a href="https://github.com/confluentinc/confluent-kafka-dotnet">Confluent.Kafka</a> the underlying library used for Kafka integration, provides various events for handling partition assignments, logging, statistics, and more. Silverback proxies these events as callbacks.</p>
<h3 id="consumer-callbacks">Consumer Callbacks</h3>
<p>The following callbacks are available for Kafka consumers:</p>
<ul>
<li><a class="xref" href="../../api/Silverback.Messaging.Broker.Callbacks.IKafkaPartitionsAssignedCallback.html">IKafkaPartitionsAssignedCallback</a><br>
Triggered when the consumer receives a new partition assignment.</li>
<li><a class="xref" href="../../api/Silverback.Messaging.Broker.Callbacks.IKafkaPartitionsRevokedCallback.html">IKafkaPartitionsRevokedCallback</a><br>
Triggered when partition assignments are revoked.</li>
<li><a class="xref" href="../../api/Silverback.Messaging.Broker.Callbacks.IKafkaOffsetCommittedCallback.html">IKafkaOffsetCommittedCallback</a><br>
Triggered when the consumer commits offsets.</li>
<li><a class="xref" href="../../api/Silverback.Messaging.Broker.Callbacks.IKafkaConsumerErrorCallback.html">IKafkaConsumerErrorCallback</a><br>
Triggered when an error occurs.</li>
<li><a class="xref" href="../../api/Silverback.Messaging.Broker.Callbacks.IKafkaConsumerStatisticsCallback.html">IKafkaConsumerStatisticsCallback</a><br>
Triggered when consumer statistics are received (requires <code>StatisticsIntervalMs &gt; 0</code>).</li>
<li><a class="xref" href="../../api/Silverback.Messaging.Broker.Callbacks.IKafkaConsumerLogCallback.html">IKafkaConsumerLogCallback</a><br>
Triggered when the consumer logs a message.</li>
<li><a class="xref" href="../../api/Silverback.Messaging.Broker.Callbacks.IKafkaPartitionEofCallback.html">IKafkaPartitionEofCallback</a><br>
Triggered when the consumer reaches the end of a partition (requires EnablePartitionEof = true).</li>
</ul>
<h4 id="example-resetting-offsets-on-partition-assignment">Example: Resetting Offsets on Partition Assignment</h4>
<p>In this example, the callback resets the offset to the beginning of each assigned partition, ensuring that past messages are replayed.</p>
<pre><code class="lang-csharp">.AddSilverback()
.WithConnectionToMessageBroker(options =&gt; options.AddKafka())
.AddKafkaClients(clients =&gt; clients
    .WithBootstrapServers(...)
    .AddProducer(...)
    .AddConsumer(...))
.AddSingletonBrokerCallbackHandler&lt;OffsetsResetCallbackHandler&gt;();
</code></pre>
<pre><code class="lang-csharp">public class OffsetsResetCallbackHandler : IKafkaPartitionsAssignedCallback
{
    public IEnumerable&lt;TopicPartitionOffset&gt;? OnPartitionsAssigned(
        IReadOnlyCollection&lt;TopicPartition&gt; topicPartitions,
        IKafkaConsumer consumer)
    {
        // Reset offset to beginning for each assigned partition
        return topicPartitions.Select(topicPartition =&gt; 
            new TopicPartitionOffset(topicPartition, Offset.Beginning));
    }
}
</code></pre>
<h3 id="producer-callbacks">Producer Callbacks</h3>
<p>The following callbacks are available for Kafka producers:</p>
<ul>
<li><a class="xref" href="../../api/Silverback.Messaging.Broker.Callbacks.IKafkaProducerStatisticsCallback.html">IKafkaProducerStatisticsCallback</a><br>
Triggered when producer statistics are received (requires <code>StatisticsIntervalMs &gt; 0</code>).</li>
<li><a class="xref" href="../../api/Silverback.Messaging.Broker.Callbacks.IKafkaProducerLogCallback.html">IKafkaProducerLogCallback</a><br>
Triggered when the producer logs a message.</li>
</ul>
<h2 id="mqtt-specific-callbacks">MQTT-Specific Callbacks</h2>
<p>MQTT clients trigger some lifecycle events that can be handled using the following callbacks:</p>
<ul>
<li><a class="xref" href="../../api/Silverback.Messaging.Broker.Callbacks.IMqttClientConnectedCallback.html">IMqttClientConnectedCallback</a><br>
Triggered when the client successfully connects to the broker.</li>
<li><a class="xref" href="../../api/Silverback.Messaging.Broker.Callbacks.IMqttClientDisconnectingCallback.html">IMqttClientDisconnectingCallback</a><br>
Triggered when the client is about to disconnect (not called if the connection is lost unexpectedly).</li>
</ul>
<h4 id="example-sending-a-message-when-the-client-connects">Example: Sending a Message When the Client Connects</h4>
<p>In this example, a message is published as soon as the MQTT client establishes a connection.</p>
<pre><code class="lang-csharp">services
    .AddSilverback()
    .WithConnectionToMessageBroker(options =&gt; options.AddMqtt())
    .AddMqttClients(clients =&gt; clients
        .AddClient(...))
    .AddSingletonBrokerCallbacksHandler&lt;ConnectionCallbackHandler&gt;();
</code></pre>
<pre><code class="lang-csharp">public class ConnectionCallbackHandler : IMqttClientConnectedCallback
{
    private readonly IPublisher _publisher;
    
    public ConnectionCallbackHandler(IPublisher publisher)
    {
        _publisher = publisher;
    }
            
    public Task OnClientConnectedAsync(MqttClientConfig config) =&gt;
        _publisher.PublishAsync(new ClientConnectedMessage());
}
</code></pre>
<h2 id="additional-resources">Additional Resources</h2>
<p>For more details, refer to the <a class="xref" href="../../api/Silverback.html">API Reference</a> for each callback interface.</p>
</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/beagle1984/silverback/blob/master/docs/guides/broker/callbacks.md/#L1" class="contribution-link">Improve this doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="footer">
          <div class="container contacts">
            <a href="https://github.com/BEagle1984" rel="nofollow noopener noreferrer"><i class='fab fa-github'></i> GitHub</a>
            <a href="mailto:silverback-project@outlook.com" rel="nofollow noopener noreferrer"><i class='fas fa-envelope'></i> E-Mail</a>
          </div>
          <div class="container">
            <span class="pull-right">
              <a href="#top">&uarr; Back to top</a>
            </span>
      © 2025 Sergio Aquilini
      
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
